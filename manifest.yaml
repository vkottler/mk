---
default_target: groups-all

params:
  project: vmklib
  python_version: "$PYTHON_VERSION"
  entry: mk

includes:
  - config/includes/python.yaml
  - config/includes/license.yaml
  - config/includes/funding.yaml

templates:
  - local/templates

compiles:
  - name: local
    configs:
      - local/configs
    variables:
      - local/variables
    schemas:
      - local/schemas
    schema_types:
      - local/schema_types

# We need alternate versions of the 'help' scaffolding.
commands:
  - name: install-local-custom
    command: mk
    arguments:
      - python-editable
      - "PYTHON_VERSION={{python_version}}"
    dependencies:
      - groups-python-no-cli
      - renders-__main__.py
      - renders-entry.py

  - name: help_custom
    command: "./venv{{python_version}}/bin/{{entry}}"
    force: true
    arguments:
      - "-h"
    dependencies:
      - commands-install-local-custom

renders:
  - name: README.md
    output_dir: "."
    dependencies:
      - compiles-local
      - commands-help_custom
      - renders-python_readme_header.md
      - renders-python_readme_dep_graph.md

  - name: header.mk
    output_dir: "{{project}}/data/data"
    dependencies:
      - compiles-local

groups:
  - name: all
    dependencies:
      - groups-license
      - groups-funding
      - renders-README.md
      - renders-header.mk
